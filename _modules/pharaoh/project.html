<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pharaoh.project &mdash; Pharaoh 0.9.4.dev5+gb54425102 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx_rtd_theme_overrides.css?v=6ccba6a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=b1c8eef7"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ededed" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/icon.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                Pharaoh v0.9.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#working-principle">Working Principle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installation-via-pip">Installation via Pip</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#create-a-virtual-environment">Create a virtual environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#install">Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../installation.html#extras">Extras</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#preface">Preface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#project-generation">Project Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#update-settings">Update Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#manage-components">Manage Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#manage-asset-scripts">Manage Asset Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#modify-templates">Modify Templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../template_designer_guide.html">Template Designer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/project_structure.html">Project Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/settings.html">Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/settings.html#default-settings">Default Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/settings.html#custom-settings">Custom Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/settings.html#accessing-settings">Accessing Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/settings.html#custom-resolvers">Custom Resolvers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/components.html">Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/components.html#what-s-a-component">What’s a Component?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/components.html#resources">Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/components.html#templates">Templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/components.html#managing-components">Managing Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/components.html#adding-components">Adding Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/components.html#updating-components">Updating Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/components.html#removing-components">Removing Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/components.html#finding-components">Finding Components</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/components.html#built-in-templates">Built-In Templates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/assets.html">Assets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/assets.html#what-s-an-asset">What’s an Asset?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/assets.html#executing-asset-generation">Executing Asset Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/assets.html#debugging-asset-scripts">Debugging Asset Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/assets.html#implementing-asset-scripts">Implementing Asset Scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#metadata-stack">Metadata Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#manually-registering-assets">Manually Registering Assets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#catching-errors">Catching Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#patched-frameworks">Patched Frameworks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#force-static-exports">Force Static Exports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#matlab-integration">Matlab Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/assets.html#asset-lookup">Asset Lookup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#asset-finder">Asset Finder</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#manual-include">Manual Include</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/assets.html#grouping-assets-by-metadata">Grouping Assets By Metadata</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/directive.html">Pharaoh Directive</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/directive.html#directive-options">Directive Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/directive.html#asset-templates">Asset Templates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/building.html">Building</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/building.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/building.html#build-api">Build API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/building.html#archiving">Archiving</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/templating.html">Templating</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/templating.html#generation-time-templating">Generation-time Templating</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/templating.html#basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/templating.html#single-file-templates">Single-file Templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/templating.html#build-time-templating">Build-time Templating</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/templating.html#template-inheritance">Template Inheritance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/templating.html#rendering-context">Rendering Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/templating.html#extending-template-syntax">Extending Template Syntax</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/api.html">API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api.html#pharaoh-api-module">Pharaoh API Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.api.get_project"><code class="docutils literal notranslate"><span class="pre">get_project()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject"><code class="docutils literal notranslate"><span class="pre">PharaohProject</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.PROJECT_SETTINGS_YAML"><code class="docutils literal notranslate"><span class="pre">PROJECT_SETTINGS_YAML</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.__init__"><code class="docutils literal notranslate"><span class="pre">__init__()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.add_component"><code class="docutils literal notranslate"><span class="pre">add_component()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.add_template_to_component"><code class="docutils literal notranslate"><span class="pre">add_template_to_component()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.archive_report"><code class="docutils literal notranslate"><span class="pre">archive_report()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.asset_build_dir"><code class="docutils literal notranslate"><span class="pre">asset_build_dir</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.asset_finder"><code class="docutils literal notranslate"><span class="pre">asset_finder</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.build_report"><code class="docutils literal notranslate"><span class="pre">build_report()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.filter_components"><code class="docutils literal notranslate"><span class="pre">filter_components()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.find_components"><code class="docutils literal notranslate"><span class="pre">find_components()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.generate_assets"><code class="docutils literal notranslate"><span class="pre">generate_assets()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.get_default_sphinx_configuration"><code class="docutils literal notranslate"><span class="pre">get_default_sphinx_configuration()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.get_resource"><code class="docutils literal notranslate"><span class="pre">get_resource()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.get_setting"><code class="docutils literal notranslate"><span class="pre">get_setting()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.get_settings"><code class="docutils literal notranslate"><span class="pre">get_settings()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.iter_components"><code class="docutils literal notranslate"><span class="pre">iter_components()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.iter_resources"><code class="docutils literal notranslate"><span class="pre">iter_resources()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.load_settings"><code class="docutils literal notranslate"><span class="pre">load_settings()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.open_report"><code class="docutils literal notranslate"><span class="pre">open_report()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.project_root"><code class="docutils literal notranslate"><span class="pre">project_root</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.put_setting"><code class="docutils literal notranslate"><span class="pre">put_setting()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.remove_component"><code class="docutils literal notranslate"><span class="pre">remove_component()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.save_settings"><code class="docutils literal notranslate"><span class="pre">save_settings()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.settings_file"><code class="docutils literal notranslate"><span class="pre">settings_file</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.sphinx_report_build"><code class="docutils literal notranslate"><span class="pre">sphinx_report_build</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.sphinx_report_project"><code class="docutils literal notranslate"><span class="pre">sphinx_report_project</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.sphinx_report_project_components"><code class="docutils literal notranslate"><span class="pre">sphinx_report_project_components</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.project.PharaohProject.update_resource"><code class="docutils literal notranslate"><span class="pre">update_resource()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api.html#asset-generation-api-module">Asset Generation API Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.catch_exceptions"><code class="docutils literal notranslate"><span class="pre">catch_exceptions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.find_components"><code class="docutils literal notranslate"><span class="pre">find_components()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.get_asset_finder"><code class="docutils literal notranslate"><span class="pre">get_asset_finder()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.get_current_component"><code class="docutils literal notranslate"><span class="pre">get_current_component()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.get_resource"><code class="docutils literal notranslate"><span class="pre">get_resource()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.metadata_context"><code class="docutils literal notranslate"><span class="pre">metadata_context()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.register_asset"><code class="docutils literal notranslate"><span class="pre">register_asset()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.register_templating_context"><code class="docutils literal notranslate"><span class="pre">register_templating_context()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder"><code class="docutils literal notranslate"><span class="pre">AssetFinder</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder.__init__"><code class="docutils literal notranslate"><span class="pre">__init__()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder.discover_assets"><code class="docutils literal notranslate"><span class="pre">discover_assets()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder.get_asset_by_id"><code class="docutils literal notranslate"><span class="pre">get_asset_by_id()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder.iter_assets"><code class="docutils literal notranslate"><span class="pre">iter_assets()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder.search_assets"><code class="docutils literal notranslate"><span class="pre">search_assets()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.AssetFinder.sort_assets"><code class="docutils literal notranslate"><span class="pre">sort_assets()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.Asset"><code class="docutils literal notranslate"><span class="pre">Asset</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.Asset.copy_to"><code class="docutils literal notranslate"><span class="pre">copy_to()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.Asset.read_bytes"><code class="docutils literal notranslate"><span class="pre">read_bytes()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.Asset.read_json"><code class="docutils literal notranslate"><span class="pre">read_json()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.Asset.read_text"><code class="docutils literal notranslate"><span class="pre">read_text()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.Asset.read_yaml"><code class="docutils literal notranslate"><span class="pre">read_yaml()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.finder.asset_groupby"><code class="docutils literal notranslate"><span class="pre">asset_groupby()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api.html#resources">Resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.FileResource"><code class="docutils literal notranslate"><span class="pre">FileResource</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.FileResource.first_match"><code class="docutils literal notranslate"><span class="pre">first_match()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.FileResource.get_files"><code class="docutils literal notranslate"><span class="pre">get_files()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.FileResource.get_match"><code class="docutils literal notranslate"><span class="pre">get_match()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.FileResource.last_match"><code class="docutils literal notranslate"><span class="pre">last_match()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.FileResource.locate"><code class="docutils literal notranslate"><span class="pre">locate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.CustomResource"><code class="docutils literal notranslate"><span class="pre">CustomResource</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.Resource"><code class="docutils literal notranslate"><span class="pre">Resource</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.LocalResource"><code class="docutils literal notranslate"><span class="pre">LocalResource</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.LocalResource.locate"><code class="docutils literal notranslate"><span class="pre">locate()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.TransformedResource"><code class="docutils literal notranslate"><span class="pre">TransformedResource</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.resource.TransformedResource.transform"><code class="docutils literal notranslate"><span class="pre">transform()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api.html#matlab-integration-api">Matlab Integration API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab"><code class="docutils literal notranslate"><span class="pre">Matlab</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.__enter__"><code class="docutils literal notranslate"><span class="pre">__enter__()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.__exit__"><code class="docutils literal notranslate"><span class="pre">__exit__()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.__init__"><code class="docutils literal notranslate"><span class="pre">__init__()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.connect"><code class="docutils literal notranslate"><span class="pre">connect()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.eng"><code class="docutils literal notranslate"><span class="pre">eng</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.execute_function"><code class="docutils literal notranslate"><span class="pre">execute_function()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.execute_script"><code class="docutils literal notranslate"><span class="pre">execute_script()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#pharaoh.assetlib.api.Matlab.show_gui"><code class="docutils literal notranslate"><span class="pre">show_gui()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api.html#templating-builtins">Templating Builtins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#jinja2-builtins">Jinja2 Builtins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#pharaoh-extension">Pharaoh Extension</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#globals">Globals</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.assert_true"><code class="docutils literal notranslate"><span class="pre">assert_true()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.fglob"><code class="docutils literal notranslate"><span class="pre">fglob()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.hrule"><code class="docutils literal notranslate"><span class="pre">hrule()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.raise_helper"><code class="docutils literal notranslate"><span class="pre">raise_helper()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.heading"><code class="docutils literal notranslate"><span class="pre">heading()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.rand_id"><code class="docutils literal notranslate"><span class="pre">rand_id()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_globals.read_text"><code class="docutils literal notranslate"><span class="pre">read_text()</span></code></a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../reference/api.html#filters">Filters</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.hasattr_"><code class="docutils literal notranslate"><span class="pre">hasattr_()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.required"><code class="docutils literal notranslate"><span class="pre">required()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.rep"><code class="docutils literal notranslate"><span class="pre">rep()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.or_default"><code class="docutils literal notranslate"><span class="pre">or_default()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.oc_resolve"><code class="docutils literal notranslate"><span class="pre">oc_resolve()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.oc_get"><code class="docutils literal notranslate"><span class="pre">oc_get()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.exists"><code class="docutils literal notranslate"><span class="pre">exists()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.to_path"><code class="docutils literal notranslate"><span class="pre">to_path()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.md2html"><code class="docutils literal notranslate"><span class="pre">md2html()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../reference/api.html#pharaoh.templating.second_level.env_filters.rsub"><code class="docutils literal notranslate"><span class="pre">rsub()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api.html#ansible-filters">Ansible Filters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api.html#plugin-api">Plugin API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/cli.html">CLI Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/cli.html#preface">Preface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/cli.html#commands">Commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#new">New</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#add">Add</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#update-resource">Update-resource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#add-template">Add-template</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#remove">Remove</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#env">Env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#generate">Generate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#build">Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#show-report">Show-report</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#archive">Archive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#info">Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/cli.html#print-plugins">Print-plugins</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/index.html">Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/plugin.html">Plugin Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../plugins/plugin.html#module-pharaoh.plugins.spec">Hookspec Markers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_add_cli_commands"><code class="docutils literal notranslate"><span class="pre">pharaoh_add_cli_commands()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_asset_gen_prepare_resources"><code class="docutils literal notranslate"><span class="pre">pharaoh_asset_gen_prepare_resources()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_asset_gen_started"><code class="docutils literal notranslate"><span class="pre">pharaoh_asset_gen_started()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_build_finished"><code class="docutils literal notranslate"><span class="pre">pharaoh_build_finished()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_build_started"><code class="docutils literal notranslate"><span class="pre">pharaoh_build_started()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_collect_default_settings"><code class="docutils literal notranslate"><span class="pre">pharaoh_collect_default_settings()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_collect_l1_templates"><code class="docutils literal notranslate"><span class="pre">pharaoh_collect_l1_templates()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_collect_l2_templates"><code class="docutils literal notranslate"><span class="pre">pharaoh_collect_l2_templates()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_collect_resource_types"><code class="docutils literal notranslate"><span class="pre">pharaoh_collect_resource_types()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_configure_sphinx"><code class="docutils literal notranslate"><span class="pre">pharaoh_configure_sphinx()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_find_asset_render_template"><code class="docutils literal notranslate"><span class="pre">pharaoh_find_asset_render_template()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_get_asset_render_template_mappings"><code class="docutils literal notranslate"><span class="pre">pharaoh_get_asset_render_template_mappings()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_modify_gitignore"><code class="docutils literal notranslate"><span class="pre">pharaoh_modify_gitignore()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_project_created"><code class="docutils literal notranslate"><span class="pre">pharaoh_project_created()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../plugins/plugin.html#pharaoh.plugins.spec.pharaoh_sphinx_app_inited"><code class="docutils literal notranslate"><span class="pre">pharaoh_sphinx_app_inited()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/demo_reports.html">Demo Reports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/demo_reports.html#html">HTML</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../examples/demo_reports.html#measurement-report">Measurement Report</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/demo_reports.html#confluence">Confluence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../examples/demo_reports.html#trend-report">Trend Report</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/asset_scripts.html">Asset Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contact.html#help">Help!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contact.html#bug-reports">Bug reports</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Release History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id1">0.9.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id2">0.9.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id3">0.9.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id4">0.9.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id5">0.8.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id6">0.8.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id7">0.8.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id8">0.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id9">0.7.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id10">0.7.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id11">0.7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id12">0.7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id13">0.7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id14">0.6.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id15">0.6.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changelog.html#id16">0.6.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dev.html#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#running-from-source-tree">Running from source tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#running-tests">Running tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#running-linters-and-code-formatters">Running linters and code formatters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#code-style-guide">Code style guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#building-documentation">Building documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dev.html#contributing">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#submitting-pull-requests">Submitting pull requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#automated-testing">Automated testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#changelog-entries">Changelog entries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev.html#contents-of-a-changelog-entry">Contents of a changelog entry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dev.html#creating-a-new-release">Creating a new release</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dev.html#current-maintainers">Current maintainers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ededed" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Pharaoh</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pharaoh.project</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pharaoh.project</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">attr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">attrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">omegaconf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">omegaconf.errors</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pharaoh</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pharaoh.log</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pharaoh.util.oc_resolvers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.assetlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">finder</span><span class="p">,</span> <span class="n">resource</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.assetlib.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">context_stack</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.errors</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssetGenerationError</span><span class="p">,</span> <span class="n">ProjectInconsistentError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.plugins.plugin_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">PM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.util.contextlib_chdir</span><span class="w"> </span><span class="kn">import</span> <span class="n">chdir</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">jinja2</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">PHARAOH_CLI_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;pharaoh.exe&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>  <span class="c1"># type: ignore[arg-type]</span>
<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
    <span class="n">PHARAOH_CLI_PATH</span> <span class="o">=</span> <span class="s2">&quot;pharaoh.exe&quot;</span>

<span class="n">PathLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span>

<span class="n">LRU_PHARAOH_PROJECT</span><span class="p">:</span> <span class="n">PharaohProject</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">DEFAULT_MISSING</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log</span>


<div class="viewcode-block" id="get_project">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.get_project">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_project</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PharaohProject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an instance of PharaohProject.</span>

<span class="sd">    :param lookup_path: If None, the function tries to return the Pharaoh singleton instance that is already loaded in</span>
<span class="sd">                        memory and raises and exception if there is none.</span>
<span class="sd">                        If given a string or Path instance, searches the given path and all its parent folders</span>
<span class="sd">                        for a ``pharaoh.yaml`` project file and returns a PharaohProject instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lookup_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Enforce having a singleton per process</span>
        <span class="k">if</span> <span class="n">LRU_PHARAOH_PROJECT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No PharaohProject instance created yet!&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LRU_PHARAOH_PROJECT</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
        <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lookup_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">lookup_path</span> <span class="o">=</span> <span class="n">lookup_path</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unsupported value for argument &#39;lookup_path&#39;.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">lookup_path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="n">PharaohProject</span><span class="o">.</span><span class="n">PROJECT_SETTINGS_YAML</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">PharaohProject</span><span class="p">(</span><span class="n">project_root</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="c1"># We reached the path&#39;s anchor level</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot find a Pharaoh project file </span><span class="si">{</span><span class="n">PharaohProject</span><span class="o">.</span><span class="n">PROJECT_SETTINGS_YAML</span><span class="si">}</span><span class="s2"> in &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lookup_path</span><span class="si">}</span><span class="s2"> or one of its parent directories!&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span></div>



<div class="viewcode-block" id="PharaohProject">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PharaohProject</span><span class="p">:</span>
    <span class="n">PROJECT_SETTINGS_YAML</span> <span class="o">=</span> <span class="s2">&quot;pharaoh.yaml&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Cache the last recently used project instance in a global variable,</span>
        <span class="c1"># so it can be accessed from anywhere after creation</span>
        <span class="k">global</span> <span class="n">LRU_PHARAOH_PROJECT</span>  <span class="c1"># noqa: PLW0603</span>
        <span class="n">LRU_PHARAOH_PROJECT</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LRU_PHARAOH_PROJECT</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># noqa: SIM105</span>
            <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">remove_filehandlers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="PharaohProject.__init__">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_root</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">templates</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pharaoh.default_project&quot;</span><span class="p">,),</span>
        <span class="n">template_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates a Pharaoh project instance using either an existing project root</span>
<span class="sd">        (directory containing pharaoh.yaml) or creates a new project.</span>

<span class="sd">        :param project_root: A directory containing a pharaoh.yaml file</span>
<span class="sd">        :param overwrite: If the project directory already contains files, overwrite them.</span>
<span class="sd">        :param templates: The project template(s) to use for creating the Sphinx project files.</span>
<span class="sd">                          Maybe be any number of template names or paths to directories.</span>
<span class="sd">        :param template_context: The Jinja rendering context for the selected project templates.</span>
<span class="sd">        :keyword custom_settings: A path to a YAML file containing settings to overwrite the default project settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merged_settings</span><span class="p">:</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">project_root</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asset_finder</span><span class="p">:</span> <span class="n">finder</span><span class="o">.</span><span class="n">AssetFinder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">logging_add_filehandler</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;logging_add_filehandler&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">custom_settings</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;custom_settings&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown keyword arguments </span><span class="si">{</span><span class="nb">tuple</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">!&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">add_streamhandler</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">logging_add_filehandler</span><span class="p">:</span>
            <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">add_filehandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span><span class="p">)</span>
            <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">add_warning_filehandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="n">templates</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_project</span><span class="p">(</span>
            <span class="n">templates</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">templates</span><span class="p">),</span>
            <span class="n">template_context</span><span class="o">=</span><span class="n">template_context</span><span class="p">,</span>
            <span class="n">recreate</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
            <span class="n">custom_settings</span><span class="o">=</span><span class="n">custom_settings</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;logging.level&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span></div>


<div class="viewcode-block" id="PharaohProject.load_settings">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.load_settings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads settings from various namespaces.</span>

<span class="sd">        default</span>
<span class="sd">            The default setting in the Pharaoh library</span>

<span class="sd">        project</span>
<span class="sd">            The project settings that may be modified by the user</span>

<span class="sd">        env</span>
<span class="sd">            The settings defined by environment variables starting with PHARAO</span>

<span class="sd">        all</span>
<span class="sd">            Loads all of the above</span>

<span class="sd">        :param namespace: The namespace to load settings from. all, default, project or env.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_default_settings</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;project&quot;</span><span class="p">):</span>
            <span class="n">project_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROJECT_SETTINGS_YAML</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_settings</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;env&quot;</span><span class="p">):</span>
            <span class="n">dotlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">env_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^PHARAOH?((\.)|(__)).+$&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">env_pat</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">keys</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.|(?&lt;!_)__(?!_)&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">dotlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dotlist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">from_dotlist</span><span class="p">(</span><span class="n">dotlist</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_merged_settings</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_update_merged_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merges settings from all namespaces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_merged_settings</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

<div class="viewcode-block" id="PharaohProject.get_settings">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.get_settings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns merged settings from all namespaces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merged_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_merged_settings</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merged_settings</span></div>


<div class="viewcode-block" id="PharaohProject.put_setting">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.put_setting">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">put_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a setting by its dot-separated name, e.g. &quot;core.debug&quot;.</span>

<span class="sd">        This has no effect, if there is an environment variable defining the same setting!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># todo: Let put_setting be able to overwrite settings defined in env vars.</span>
        <span class="c1">#       Currently env vars have priority.</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_settings</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">paths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_merged_settings</span><span class="p">()</span></div>


<div class="viewcode-block" id="PharaohProject.get_setting">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.get_setting">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_MISSING</span><span class="p">,</span> <span class="n">to_container</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">resolve</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a setting by its dot-separated name, e.g. &quot;core.debug&quot;.</span>

<span class="sd">        The settings are preferably taken from environment variables (e.g. PHARAOH.CORE.DEBUG), whereas the values</span>
<span class="sd">        must be TOML compatible values (e.g. &quot;true&quot; for boolean).</span>

<span class="sd">        If no environment variable is found, the user defined settings in the pharaoh.yaml file in the</span>
<span class="sd">        project root will be used. If the setting is not specified in there or the file is not existing,</span>
<span class="sd">        the Pharaoh default settings are queried.</span>

<span class="sd">        If the setting is not found, a LookupError is returned unless &quot;default&quot; is set.</span>

<span class="sd">        Examples::</span>

<span class="sd">            proj.get_setting(&quot;report.title&quot;)</span>
<span class="sd">            proj.get_setting(&quot;cloud.metadata&quot;, to_container=True, resolve=False) == {</span>
<span class="sd">                &quot;author&quot;: &quot;${report.author}&quot;,</span>
<span class="sd">                &quot;title&quot;: &quot;${report.title}&quot;,</span>
<span class="sd">            }</span>
<span class="sd">            proj.get_setting(&quot;cloud.metadata&quot;, to_container=True, resolve=True) == {</span>
<span class="sd">                &quot;author&quot;: &quot;loibljoh&quot;,</span>
<span class="sd">                &quot;title&quot;: &quot;Pharaoh Report&quot;,</span>
<span class="sd">            }</span>
<span class="sd">            proj.get_setting(&quot;cloud.metadata.title&quot;) == &quot;Pharaoh Report&quot;</span>
<span class="sd">            proj.get_setting(&quot;cloud.metadata&quot;) == omegaconf.dictconfig.DictConfig(...)</span>

<span class="sd">        :param key: Dot-separated name of the setting value to return</span>
<span class="sd">        :param default: The returned default value if the key does not exist.</span>
<span class="sd">        :param to_container: If set, recursively converts an OmegaConf config to a primitive Python container type</span>
<span class="sd">            (dict or list).</span>
<span class="sd">        :param resolve: True to resolve all values if &quot;to_container&quot; is set to True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Must be a string with a minimum length of 1!&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">merged_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_container</span><span class="p">(</span><span class="n">merged_settings</span><span class="p">,</span> <span class="n">resolve</span><span class="o">=</span><span class="n">resolve</span><span class="p">)</span> <span class="k">if</span> <span class="n">to_container</span> <span class="k">else</span> <span class="n">merged_settings</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">DEFAULT_MISSING</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No setting key called </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2">!&quot;</span>
                <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>
            <span class="k">return</span> <span class="n">default</span></div>


<div class="viewcode-block" id="PharaohProject.save_settings">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.save_settings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_env</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves back the project settings to the project YAML file.</span>

<span class="sd">        :param include_env: If True, Pharaoh settings that are set via environment variables will be persisted</span>
<span class="sd">            to the project settings YAML file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROJECT_SETTINGS_YAML</span>
        <span class="k">if</span> <span class="n">include_env</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_settings</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">project_settings</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_project_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROJECT_SETTINGS_YAML</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">project_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_root</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sphinx_report_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;report-project&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sphinx_report_project_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span> <span class="o">/</span> <span class="s2">&quot;components&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sphinx_report_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;report-build&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">asset_build_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span> <span class="o">/</span> <span class="s2">&quot;.asset_build&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">asset_finder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">finder</span><span class="o">.</span><span class="n">AssetFinder</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asset_finder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_asset_finder</span> <span class="o">=</span> <span class="n">finder</span><span class="o">.</span><span class="n">AssetFinder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">asset_build_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asset_finder</span>

<div class="viewcode-block" id="PharaohProject.add_component">
<a class="viewcode-back" href="../../reference/components.html#pharaoh.api.PharaohProject.add_component">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_component</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">templates</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="p">(</span><span class="n">Path</span> <span class="o">|</span> <span class="p">(</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Path</span><span class="p">]))</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pharaoh.empty&quot;</span><span class="p">,),</span>
        <span class="n">render_context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resources</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new component to the Pharaoh project</span>

<span class="sd">        Example::</span>

<span class="sd">            from pharaoh.api import FileResource, PharaohProject</span>

<span class="sd">            proj = PharaohProject(&quot;.&quot;)</span>
<span class="sd">            proj.add_component(</span>
<span class="sd">                component_name=&quot;component_ABC&quot;,</span>
<span class="sd">                templates=[</span>
<span class="sd">                    &quot;plugin_abc.template_xyz&quot;,              # plugin template</span>
<span class="sd">                    &quot;path/to/template/directory&quot;,           # template directory</span>
<span class="sd">                    &quot;path/to/template/file/tmpl.pharaoh.py&quot; # template file</span>
<span class="sd">                ],</span>
<span class="sd">                render_context={&quot;foo&quot;: &quot;bar&quot;},</span>
<span class="sd">                resources=[FileResource(alias=&quot;dlh5_result&quot;, pattern=&quot;C:/temp/**/*.dlh5&quot;)],</span>
<span class="sd">                metadata={&quot;some tag&quot;: &quot;some value&quot;},</span>
<span class="sd">                index=-1,  # append</span>
<span class="sd">                overwrite=False</span>
<span class="sd">            )</span>

<span class="sd">        :param component_name: The name of the component. Must be a valid Python identifier.</span>
<span class="sd">        :param templates: A list of component templates to use for creating the components project files.</span>
<span class="sd">            Those may be the template identifier (e.g. ``plugin_abc.template_xyz``) of a registered plugin template,</span>
<span class="sd">            a path to a template directory or a path to a template file (single-file template).</span>

<span class="sd">            Since multiple template may be specified, their order matters in cases where different templates</span>
<span class="sd">            create equally-named files, thus templates might overwrite files of the previous templates.</span>

<span class="sd">            This enables *template-composition*, where template designers can chunk their bigger templates into</span>
<span class="sd">            smaller reusable building blocks.</span>

<span class="sd">            If omitted, an empty default template is used.</span>

<span class="sd">        :param render_context: The Jinja rendering context for the selected template.</span>
<span class="sd">                               The actual template rendering context will have ``component_name``, ``resources`` and</span>
<span class="sd">                               ``metadata`` available under the respective keys.</span>
<span class="sd">        :param resources: A list of Resource instances, defining the component&#39;s resources used in asset scripts</span>
<span class="sd">        :param metadata: A dictionary of metadata that may be used to find the component via</span>
<span class="sd">                         :func:`PharaohProject.find_component()</span>
<span class="sd">                         &lt;pharaoh.project.PharaohProject.find_component&gt;` method.</span>
<span class="sd">        :param overwrite: If True, an already existing component will be overwritten</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.templating.first_level.find</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_template</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.templating.first_level.render</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_template</span>

        <span class="c1"># Check if component with this name already added</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">component</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">component_name</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Component </span><span class="si">{</span><span class="n">component_name</span><span class="si">!r}</span><span class="s2"> already exists!&quot;</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

        <span class="n">render_context</span> <span class="o">=</span> <span class="n">render_context</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">render_context</span><span class="p">[</span><span class="s2">&quot;pharaoh_cli_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PHARAOH_CLI_PATH</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">templates</span><span class="p">)]</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No templates specified!&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">new_component</span> <span class="o">=</span> <span class="n">Component</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">component_name</span><span class="p">,</span>
            <span class="n">templates</span><span class="o">=</span><span class="n">templates</span><span class="p">,</span>
            <span class="n">render_context</span><span class="o">=</span><span class="n">render_context</span><span class="p">,</span>
            <span class="n">resources</span><span class="o">=</span><span class="n">resources</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span>

        <span class="c1"># Support negative indexing where -1 is the last item. Normal insert with -1 will insert at second last index.</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span>

        <span class="n">components</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span>
            <span class="n">attrs</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">new_component</span><span class="p">),</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">templ</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_path</span> <span class="o">=</span> <span class="n">find_template</span><span class="p">(</span><span class="n">templ</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">template_path</span> <span class="o">/</span> <span class="s2">&quot;[[ component_name ]]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>  <span class="c1"># pragma: no cover</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;The usage of [[ component_name ]] as top level directory name of component &quot;</span>
                    <span class="s2">&quot;templates is not required anymore. &quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">render_template</span><span class="p">(</span>
                <span class="n">template_path</span><span class="o">=</span><span class="n">template_path</span><span class="p">,</span>
                <span class="n">outputdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project_components</span> <span class="o">/</span> <span class="n">component_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">new_component</span><span class="o">.</span><span class="n">get_render_context</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_project_settings</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_settings</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added component </span><span class="si">{</span><span class="n">component_name</span><span class="si">!r}</span><span class="s2">. Saved project.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PharaohProject.add_template_to_component">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.add_template_to_component">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_template_to_component</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">templates</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">render_context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds additional templates to an existing component, that may overwrite existing files during rendering.</span>

<span class="sd">        :param component_name: The name of the component. Must be a valid Python identifier.</span>
<span class="sd">        :param templates: The component template(s) to use for creating the components project files.</span>
<span class="sd">                          Maybe be the a single or multiple template names or paths to a directory.</span>
<span class="sd">        :param render_context: The Jinja rendering context for the selected template.</span>
<span class="sd">                               The actual template rendering context will have component_name, resources and metadata</span>
<span class="sd">                               available under the respective keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.templating.first_level.find</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_template</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.templating.first_level.render</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_template</span>

        <span class="c1"># Check if component with this name already added</span>
        <span class="k">for</span> <span class="n">component_index</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">()):</span>  <span class="c1"># noqa: B007</span>
            <span class="k">if</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">component_name</span><span class="p">:</span>
                <span class="n">component</span> <span class="o">=</span> <span class="n">Component</span><span class="o">.</span><span class="n">from_dictconfig</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Component </span><span class="si">{</span><span class="n">component_name</span><span class="si">!r}</span><span class="s2"> does not exist!&quot;</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">render_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">render_context</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">templates</span><span class="p">)]</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No templates specified!&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">component</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">templates</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">templ</span> <span class="ow">in</span> <span class="n">templates</span><span class="p">:</span>
            <span class="n">template_path</span> <span class="o">=</span> <span class="n">find_template</span><span class="p">(</span><span class="n">templ</span><span class="p">)</span>
            <span class="n">render_template</span><span class="p">(</span>
                <span class="n">template_path</span><span class="o">=</span><span class="n">template_path</span><span class="p">,</span>
                <span class="n">outputdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project_components</span> <span class="o">/</span> <span class="n">component_name</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">component</span><span class="o">.</span><span class="n">get_render_context</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_project_settings</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">component_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_merged_settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_settings</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated component </span><span class="si">{</span><span class="n">component_name</span><span class="si">!r}</span><span class="s2">. Saved project.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="PharaohProject.remove_component">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.remove_component">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_component</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes one or multiple existing components.</span>

<span class="sd">        :param filter: A case-insensitive component filter. Either a full-match or regular expression, depending on</span>
<span class="sd">            regex argument.</span>
<span class="sd">        :param regex: If True, the filter argument will be treated as regular expression. Components</span>
<span class="sd">            that partially match the regular expression are removed.</span>
<span class="sd">        :returns: A list of component names that got removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if component with this name already added</span>
        <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
            <span class="n">rex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">regex</span> <span class="ow">and</span> <span class="n">rex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="nb">filter</span><span class="p">:</span>
                <span class="n">comp_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project_components</span> <span class="o">/</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">comp_files</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">comp_files</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>  <span class="c1"># pragma: no cover</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">comp_files</span><span class="p">)</span>
                <span class="n">removed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">removed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project_settings</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="n">components</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_settings</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed components </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">removed</span><span class="p">)</span><span class="si">}</span><span class="s2">. Saved project.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">removed</span></div>


<div class="viewcode-block" id="PharaohProject.iter_components">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.iter_components">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">iter_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filtered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over all components from a project.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filter_include</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.component_filter.include&quot;</span><span class="p">,</span> <span class="s2">&quot;.*&quot;</span><span class="p">)</span>
        <span class="n">filter_exclude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.component_filter.exclude&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;components&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]</span>

        <span class="c1"># input validation</span>
        <span class="n">filter_include</span> <span class="o">=</span> <span class="s2">&quot;.*&quot;</span> <span class="k">if</span> <span class="n">filter_include</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">filter_include</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_include</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid pharaoh.yaml: report.component_filter.include must be either set to a string or left empty.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">filter_exclude</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_exclude</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid pharaoh.yaml: report.component_filter.exclude must be either set to a string or left empty.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filtered</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
                <span class="n">filters_matched</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">filter_include</span><span class="p">,</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">filter_exclude</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">filter_exclude</span><span class="p">,</span> <span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">filters_matched</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">filters_matched</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">component</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">components</span></div>


<div class="viewcode-block" id="PharaohProject.find_components">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.find_components">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">filtered</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find components by their metadata using an evaluated expression.</span>

<span class="sd">        The expression must be a valid Python expression and following local variables may be used:</span>

<span class="sd">        - name: The name of the component</span>
<span class="sd">        - templates: A list of templates used to render the component</span>
<span class="sd">        - metadata: A dict of metadata specified</span>
<span class="sd">        - render_context: The Jinja rendering context specified</span>
<span class="sd">        - resources: A list of resource definitions</span>

<span class="sd">        :param expression: A Python expression that will be evaluated. If it evaluates to a truthy result,</span>
<span class="sd">           the component name is included in the returned list.</span>

<span class="sd">           Example: ``name == &quot;dummy&quot; and metadata.foo in (1,2,3)``.</span>

<span class="sd">           A failing evaluation will be treated as False. An empty expression will always match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">(</span><span class="n">filtered</span><span class="o">=</span><span class="n">filtered</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expression</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="p">{},</span> <span class="n">comp</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span></div>


<div class="viewcode-block" id="PharaohProject.filter_components">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.filter_components">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">filter_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a component filter to the project config (report.component_filter.include/exclude).</span>
<span class="sd">        Use this to create variants of the same report (think full/light version).</span>
<span class="sd">        Include- and Exclude-expressions can be used at the same time for efficient filtering.</span>

<span class="sd">        :param include: A regular expression which matches on the component names to be included.</span>
<span class="sd">        :param exclude: A regular expression which matches on the component names to be excluded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No filter expression provided. At least one must be provided.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">filter_include</span> <span class="o">=</span> <span class="s2">&quot;.*&quot;</span> <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">include</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_setting</span><span class="p">(</span><span class="s2">&quot;report.component_filter.include&quot;</span><span class="p">,</span> <span class="n">filter_include</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_setting</span><span class="p">(</span><span class="s2">&quot;report.component_filter.exclude&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span></div>


<div class="viewcode-block" id="PharaohProject.get_resource">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.get_resource">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds a Resource from a project component by its alias.</span>

<span class="sd">        :param component: The component&#39;s name</span>
<span class="sd">        :param alias: The resource&#39;s alias</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_resources</span><span class="p">(</span><span class="n">component</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">alias</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_cachedir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span> <span class="o">/</span> <span class="s2">&quot;.resource_cache&quot;</span> <span class="o">/</span> <span class="n">component</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">obj</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Cannot find resource </span><span class="si">{</span><span class="n">alias</span><span class="si">!r}</span><span class="s2"> in component </span><span class="si">{</span><span class="n">component</span><span class="si">!r}</span><span class="s2">!&quot;</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="PharaohProject.iter_resources">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.iter_resources">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">iter_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an iterator over all resources from a project component.</span>

<span class="sd">        :param component: The component&#39;s name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">component</span><span class="p">:</span>
                <span class="k">yield from</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;resources&quot;</span><span class="p">]</span>
                <span class="k">return</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Component </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2"> does not exist!&quot;</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="PharaohProject.update_resource">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.update_resource">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a Resource from a project component by its alias.</span>

<span class="sd">        :param component: The component&#39;s name</span>
<span class="sd">        :param alias: The resource&#39;s alias</span>
<span class="sd">        :param resource: The resource&#39;s alias</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">component</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;resources&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">alias</span><span class="p">:</span>
                        <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">save_settings</span><span class="p">()</span>
                        <span class="k">return</span>
                <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;resources&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_settings</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Component </span><span class="si">{</span><span class="n">component</span><span class="si">}</span><span class="s2"> does not exist!&quot;</span>
        <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="PharaohProject.get_default_sphinx_configuration">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.get_default_sphinx_configuration">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_sphinx_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confdir</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides Sphinx project configurations, that will be dynamically included by the generated conf.py.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">confdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">confdir</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pharaoh_jinja_templates&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;pharaoh_jinja_context&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s2">&quot;extensions&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;sphinx_design&quot;</span><span class="p">,</span>  <span class="c1"># https://github.com/executablebooks/sphinx-design</span>
                <span class="s2">&quot;pharaoh.templating.second_level.sphinx_ext.jinja_ext&quot;</span><span class="p">,</span>
                <span class="s2">&quot;pharaoh.templating.second_level.sphinx_ext.asset_ext&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.title&quot;</span><span class="p">),</span>
            <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.author&quot;</span><span class="p">),</span>
            <span class="s2">&quot;copyright&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="c1"># The suffix(es) of source filenames.</span>
            <span class="c1"># You can specify multiple suffix as a list of string:</span>
            <span class="s2">&quot;source_suffix&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.rst&quot;</span><span class="p">,</span> <span class="s2">&quot;.rst.jinja2&quot;</span><span class="p">,</span> <span class="s2">&quot;.txt&quot;</span><span class="p">],</span>
            <span class="s2">&quot;master_doc&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
            <span class="s2">&quot;templates_path&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;_templates&quot;</span><span class="p">],</span>
            <span class="c1"># List of patterns, relative to source directory, that match files and</span>
            <span class="c1"># directories to ignore when looking for source files.</span>
            <span class="c1"># This pattern also affects html_static_path and html_extra_path.</span>
            <span class="s2">&quot;exclude_patterns&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.asset_build&quot;</span><span class="p">,</span> <span class="s2">&quot;**/asset_scripts&quot;</span><span class="p">],</span>
            <span class="c1"># Make sure the target is unique</span>
            <span class="s2">&quot;autosectionlabel_prefix_document&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="c1"># Latex Builder (PDF)</span>
        <span class="p">}</span>

        <span class="c1"># compute exclusions based on project config</span>
        <span class="n">all_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">()}</span>
        <span class="n">names_after_filtering</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">(</span><span class="n">filtered</span><span class="o">=</span><span class="kc">True</span><span class="p">)}</span>
        <span class="n">excluded_names</span> <span class="o">=</span> <span class="n">all_names</span> <span class="o">-</span> <span class="n">names_after_filtering</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">excluded_names</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s2">&quot;exclude_patterns&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project_components</span> <span class="o">/</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="c1"># HTML Builder</span>
        <span class="n">static_path</span> <span class="o">=</span> <span class="n">confdir</span> <span class="o">/</span> <span class="s2">&quot;_static&quot;</span>
        <span class="k">assert</span> <span class="n">static_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="n">css_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">static_path</span> <span class="o">/</span> <span class="s2">&quot;css&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.css&quot;</span><span class="p">))</span>
        <span class="n">js_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">static_path</span> <span class="o">/</span> <span class="s2">&quot;js&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.js&quot;</span><span class="p">))</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;html_title&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.title&quot;</span><span class="p">),</span>
                <span class="s2">&quot;html_use_smartypants&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;html_last_updated_fmt&quot;</span><span class="p">:</span> <span class="s2">&quot;%b </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">,</span>
                <span class="s2">&quot;html_split_index&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;html_sidebars&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;**&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;searchbox.html&quot;</span><span class="p">,</span> <span class="s2">&quot;globaltoc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;sourcelink.html&quot;</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="c1"># Custom index page</span>
                <span class="c1"># https://ofosos.org/2018/12/28/landing-page-template/</span>
                <span class="c1"># html_additional_pages={&quot;index&quot;: &quot;index.html&quot;},</span>
                <span class="c1"># Add any paths that contain custom static files (such as style sheets) here,</span>
                <span class="c1"># relative to this directory. They are copied after the builtin static files,</span>
                <span class="c1"># so a file named &quot;pharaoh.css&quot; will overwrite the builtin &quot;pharaoh.css&quot;.</span>
                <span class="s2">&quot;html_static_path&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;_static&quot;</span><span class="p">],</span>
                <span class="s2">&quot;html_css_files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;css/</span><span class="si">{</span><span class="n">cssfile</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cssfile</span> <span class="ow">in</span> <span class="n">css_files</span><span class="p">],</span>
                <span class="s2">&quot;html_js_files&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;js/</span><span class="si">{</span><span class="n">jsfile</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">jsfile</span> <span class="ow">in</span> <span class="n">js_files</span><span class="p">],</span>
                <span class="s2">&quot;html_show_sphinx&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;html_show_copyright&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;html_context&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;pharaoh_version&quot;</span><span class="p">:</span> <span class="n">pharaoh</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span>
                    <span class="s2">&quot;pharaoh_logo&quot;</span><span class="p">:</span> <span class="s2">&quot;_static/html_logo.png&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pharaoh_show_logo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.html.show_pharaoh_logo&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;pharaoh_homepage&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># todo: change to RTD</span>
                <span class="p">},</span>
                <span class="s2">&quot;html_style&quot;</span><span class="p">:</span> <span class="s2">&quot;sphinx_rtd_theme_overrides.css&quot;</span><span class="p">,</span>
                <span class="s2">&quot;html_theme&quot;</span><span class="p">:</span> <span class="s2">&quot;sphinx_rtd_theme&quot;</span><span class="p">,</span>
                <span class="s2">&quot;html_theme_options&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;display_version&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;prev_next_buttons_location&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;style_external_links&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;collapse_navigation&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;sticky_navigation&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;navigation_depth&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="s2">&quot;includehidden&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_configure_sphinx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">confdir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">config</span></div>


<div class="viewcode-block" id="PharaohProject.generate_assets">
<a class="viewcode-back" href="../../reference/assets.html#pharaoh.api.PharaohProject.generate_assets">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component_filters</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">,))</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate all assets by executing the asset scripts of a selected or all components.</span>

<span class="sd">        All asset scripts are executed in separate parallel child processes</span>
<span class="sd">        (number of workers determined by ``asset_gen.worker_processes`` setting;</span>
<span class="sd">        setting 0 executes all asset scripts sequentially in the current process).</span>

<span class="sd">        Setting ``asset_gen.script_ignore_pattern`` determines if a script is ignored.</span>

<span class="sd">        Putting the comment ``# pharaoh: ignore`` at the start of a script will also ignore the file.</span>

<span class="sd">        :param component_filters: A list of regular expressions that are matched against each component name.</span>
<span class="sd">                                  If a component name matches any of the regular expressions, the component&#39;s</span>
<span class="sd">                                  assets are regenerated (containing directory will be cleared)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.assetlib.generation</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_assets</span><span class="p">,</span> <span class="n">generate_assets_parallel</span>

        <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log_version_info</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating assets...&quot;</span><span class="p">)</span>

        <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_asset_gen_started</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">(</span><span class="n">filtered</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">comp_name</span> <span class="o">=</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">comp_asset_build_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_build_dir</span> <span class="o">/</span> <span class="n">comp_name</span>
            <span class="k">for</span> <span class="n">cfilter</span> <span class="ow">in</span> <span class="n">component_filters</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">cfilter</span><span class="p">,</span> <span class="n">comp_name</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">comp_asset_build_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">comp_asset_build_dir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="n">cachedir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span> <span class="o">/</span> <span class="s2">&quot;.resource_cache&quot;</span> <span class="o">/</span> <span class="n">comp_name</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preparing resources of component </span><span class="si">{</span><span class="n">comp_name</span><span class="si">!r}</span><span class="s2"> for asset generation...&quot;</span><span class="p">)</span>
                    <span class="n">cachedir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">resources</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">resource_dict</span><span class="p">[</span><span class="s2">&quot;alias&quot;</span><span class="p">]:</span> <span class="n">resource</span><span class="o">.</span><span class="n">Resource</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">resource_dict</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">resource_dict</span> <span class="ow">in</span> <span class="n">comp</span><span class="p">[</span><span class="s2">&quot;resources&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">_cachedir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>

                    <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_asset_gen_prepare_resources</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">)</span>

                    <span class="c1"># TransformedResource may depend on others, so process them first.</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="n">r</span><span class="o">.</span><span class="n">_cachedir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cachedir</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">TransformedResource</span><span class="p">):</span>
                            <span class="n">r</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">resources</span><span class="o">=</span><span class="n">resources</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">script</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project_components</span> <span class="o">/</span> <span class="n">comp_name</span> <span class="o">/</span> <span class="s2">&quot;asset_scripts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                        <span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_name</span><span class="p">,</span> <span class="n">script</span><span class="p">))</span>
                    <span class="k">break</span>

        <span class="n">workers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;asset_gen.worker_processes&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">workers</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Run in same process - used for easier debugging</span>
            <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">asset_source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">generate_assets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="n">asset_src</span><span class="o">=</span><span class="n">asset_source</span><span class="p">,</span> <span class="n">component_name</span><span class="o">=</span><span class="n">component_name</span><span class="p">)</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset_source</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset_source</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">generate_assets_parallel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="n">asset_sources</span><span class="o">=</span><span class="n">sources</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="n">workers</span><span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;At least one error occurred while asset script execution:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">processed_asset_scripts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">script</span><span class="p">,</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Error #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">processed_asset_scripts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log_debug_info</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">AssetGenerationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_asset_scripts</span></div>


<div class="viewcode-block" id="PharaohProject.build_report">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.build_report">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catch_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds the Sphinx project and returns the status code.</span>

<span class="sd">        :param catch_errors: If True, Sphinx build errors will not raise an exception but return a -1 instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.util.docutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">docutils_namespace</span><span class="p">,</span> <span class="n">patch_docutils</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">pharaoh.sphinx_app</span><span class="w"> </span><span class="kn">import</span> <span class="n">PharaohSphinx</span>

        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.builder&quot;</span><span class="p">)</span>
        <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_build_started</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_template_dependencies</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span><span class="p">):</span>
            <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log_version_info</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Building Sphinx project using </span><span class="si">{</span><span class="n">builder</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> builder...&quot;</span><span class="p">)</span>

            <span class="n">resolved_settings</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_settings_map</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">resolved_settings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span> <span class="o">/</span> <span class="s2">&quot;pharaoh.resolved.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">resolved_settings</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>

            <span class="c1"># Sphinx is used via its API instead of the CLI because we want to modify the info/warning stream</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sourcedir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
                <span class="n">confdir</span> <span class="o">=</span> <span class="n">sourcedir</span>
                <span class="n">outputdir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span><span class="p">)</span>
                <span class="n">doctreedir</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outputdir</span><span class="si">}</span><span class="se">\\</span><span class="s2">.doctrees&quot;</span>
                <span class="n">confoverrides</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">SphinxLogRedirector</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
                <span class="n">warning</span> <span class="o">=</span> <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">SphinxLogRedirector</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
                <span class="n">freshenv</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">warningiserror</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">tags</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">verbosity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.verbosity&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">jobs</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
                <span class="n">keep_going</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">pdb</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">with</span> <span class="n">patch_docutils</span><span class="p">(</span><span class="n">confdir</span><span class="p">),</span> <span class="n">docutils_namespace</span><span class="p">():</span>
                    <span class="n">app</span> <span class="o">=</span> <span class="n">PharaohSphinx</span><span class="p">(</span>
                        <span class="n">sourcedir</span><span class="p">,</span>
                        <span class="n">confdir</span><span class="p">,</span>
                        <span class="n">outputdir</span><span class="p">,</span>
                        <span class="n">doctreedir</span><span class="p">,</span>
                        <span class="n">builder</span><span class="p">,</span>
                        <span class="n">confoverrides</span><span class="p">,</span>
                        <span class="n">status</span><span class="p">,</span>
                        <span class="n">warning</span><span class="p">,</span>
                        <span class="n">freshenv</span><span class="p">,</span>
                        <span class="n">warningiserror</span><span class="p">,</span>
                        <span class="n">tags</span><span class="p">,</span>
                        <span class="n">verbosity</span><span class="p">,</span>
                        <span class="n">jobs</span><span class="p">,</span>
                        <span class="n">keep_going</span><span class="p">,</span>
                        <span class="n">pdb</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_sphinx_app_inited</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
                    <span class="n">app</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">force_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">statuscode</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Sphinx build finished with non-zero exit code </span><span class="si">{</span><span class="n">app</span><span class="o">.</span><span class="n">statuscode</span><span class="si">}</span><span class="s2">. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;See warnings/errors in log above!&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sphinx build finished successfully! Report at:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_build_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">statuscode</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Errors occurred during Sphinx build:&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">pharaoh</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">log_debug_info</span><span class="p">()</span>

                <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_build_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">())</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">catch_errors</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>


<div class="viewcode-block" id="PharaohProject.open_report">
<a class="viewcode-back" href="../../reference/api.html#pharaoh.api.PharaohProject.open_report">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">open_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens the generated report (if possible, e.g. for local HTML reports).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.builder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">builder</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;nt&quot;</span><span class="p">:</span>
            <span class="n">report</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span> <span class="o">/</span> <span class="s2">&quot;index.html&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find HTML report </span><span class="si">{</span><span class="n">report</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">webbrowser</span>

            <span class="n">webbrowser</span><span class="o">.</span><span class="n">WindowsDefault</span><span class="p">()</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">report</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The open_report method is not implemented for builder </span><span class="si">{</span><span class="n">builder</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_archive_report_compressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an archive (zipped) from the build folder.</span>

<span class="sd">        :param dest: A destination path to create the archive. Relative paths are relative to the project root.</span>
<span class="sd">                     If omitted, the filename will be taken from the ``report.archive_name`` setting.</span>
<span class="sd">        :return: The path to the archive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dest</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.archive_name&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">base_name</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">dest</span><span class="o">.</span><span class="n">stem</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">base_name</span><span class="p">),</span> <span class="n">fmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created archive at </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dest</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_archive_report_uncompressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an archive (uncompressed) from the build folder.</span>

<span class="sd">        :param dest: A destination path to create the archive. Relative paths are relative to the project root.</span>
<span class="sd">                     If omitted, the filename will be taken from the ``report.archive_name`` setting.</span>
<span class="sd">        :return: The path to the archive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># strip file extension: if it exists, it most likely contains the &#39;.zip&#39; suffix which makes no sense</span>
        <span class="c1"># in this function</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dest</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>

        <span class="n">dest</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created archive at </span><span class="si">{</span><span class="n">dest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dest</span>

<div class="viewcode-block" id="PharaohProject.archive_report">
<a class="viewcode-back" href="../../reference/building.html#pharaoh.api.PharaohProject.archive_report">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">archive_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compression</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an archive from the build folder.</span>

<span class="sd">        :param dest: A destination path to create the archive. Relative paths are relative to the project root.</span>
<span class="sd">                     If omitted, the filename will be taken from the ``report.archive_name`` setting.</span>
<span class="sd">        :param suffix: Suffix to append to the stem of the archive&#39;s filename.</span>
<span class="sd">        :param compression: True by default, if set to False, will create an uncompressed folder instead of a zip file.</span>
<span class="sd">        :return: The path to the archive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_build</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Pharaoh report not built yet!&quot;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s2">&quot;report.archive_name&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">dest</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dest</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dest_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="n">dest_path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>

        <span class="c1"># apply suffix to the stem of the filename, not suffix as in file extension - naming is hard ;)</span>
        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="n">dest_path</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dest_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">dest_path</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">compression</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archive_report_compressed</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dest_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archive_report_uncompressed</span><span class="p">(</span><span class="n">dest_path</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dest_path</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_check_template_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the used templates of all components are have dependencies to templates that are not used in any</span>
<span class="sd">        component.</span>

<span class="sd">        E.g. &quot;plugin_abc.template_A&quot; requires an additional component that renders the &quot;plugin_abc.template_B&quot; template,</span>
<span class="sd">        in order for all glossary references to work properly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l1_templates</span> <span class="o">=</span> <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_collect_l1_templates</span><span class="p">()</span>
        <span class="n">used_templates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">dependent_templates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">(</span><span class="n">filtered</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">comp</span><span class="o">.</span><span class="n">templates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">template</span> <span class="ow">in</span> <span class="n">l1_templates</span><span class="p">:</span>
                    <span class="n">used_templates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">need</span> <span class="ow">in</span> <span class="n">l1_templates</span><span class="p">[</span><span class="n">template</span><span class="p">]</span><span class="o">.</span><span class="n">needs</span><span class="p">:</span>
                        <span class="n">dependent_templates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">need</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dependent_templates</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">used_templates</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The used project templates requires the existence of components that render &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;following templates: </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dependent_templates</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">used_templates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">ProjectInconsistentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_ensure_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">templates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">template_context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">recreate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">custom_settings</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new project by rendering the Sphinx default project at the desired project location.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">existing_files</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">existing_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recreate</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="k">lambda</span> <span class="n">func</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not delete file </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># There are existing files, check if those are the required pharaoh project files/folders</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings_file</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span><span class="p">,</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Project structure inconsistent. Missing </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">!&quot;</span>
                        <span class="k">raise</span> <span class="n">ProjectInconsistentError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">asset_build_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Create a new project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset_build_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">default_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_default_settings</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_settings</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="n">custom_settings</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">custom_settings</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
            <span class="n">default_settings</span> <span class="o">=</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">unsafe_merge</span><span class="p">(</span><span class="n">default_settings</span><span class="p">,</span> <span class="n">custom_settings</span><span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">settings_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="n">default_settings</span><span class="p">,</span> <span class="n">resolve</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="n">gitignore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_root</span> <span class="o">/</span> <span class="s2">&quot;.gitignore&quot;</span>
        <span class="n">gitignore_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;# Auto-generated by Pharaoh&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/log*.txt&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/report-build&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/report-project/.asset_build&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/report-project/.resource_cache&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/*.zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/*.idea&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_modify_gitignore</span><span class="p">(</span><span class="n">gitignore_lines</span><span class="p">)</span>
        <span class="n">gitignore</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gitignore_lines</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.templating.first_level.render</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_sphinx_base_project</span>

        <span class="n">render_sphinx_base_project</span><span class="p">(</span>
            <span class="n">outputdir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sphinx_report_project</span><span class="p">,</span>
            <span class="n">templates</span><span class="o">=</span><span class="n">templates</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="p">(</span><span class="n">template_context</span> <span class="ow">or</span> <span class="p">{}),</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;pharaoh_cli_path&quot;</span><span class="p">:</span> <span class="n">PHARAOH_CLI_PATH</span><span class="p">}},</span>  <span class="c1"># noqa: PIE800</span>
        <span class="p">)</span>

        <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_project_created</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_default_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">:</span>
        <span class="n">default_settings_collection</span> <span class="o">=</span> <span class="n">PM</span><span class="o">.</span><span class="n">pharaoh_collect_default_settings</span><span class="p">()</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">default_settings</span> <span class="ow">in</span> <span class="n">default_settings_collection</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_settings</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">default_settings</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Custom setting YAMl file </span><span class="si">{</span><span class="n">default_settings</span><span class="si">}</span><span class="s2"> does not exist!&quot;</span>
                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">default_settings</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_settings</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">default_settings</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unsupported settings type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">default_settings</span><span class="p">)</span><span class="si">}</span><span class="s2"> collected from plugin hook &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;pharaoh_collect_default_settings!&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">unsafe_merge</span><span class="p">,</span> <span class="n">loaded</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_template_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by PharaohTemplateEnv.sphinx_config_inited_hook to update the template env by</span>
<span class="sd">        project specific Jinja globals or filters</span>

<span class="sd">        :param env: the Jinja env to update</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">search_error_assets_global</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Find all error traceback assets in the project grouped by component name.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">error_assets</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_components</span><span class="p">(</span><span class="n">filtered</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">assets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_finder</span><span class="o">.</span><span class="n">search_assets</span><span class="p">(</span><span class="s2">&quot;asset_type == &#39;error_traceback&#39;&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">assets</span><span class="p">:</span>
                    <span class="n">error_assets</span><span class="p">[</span><span class="n">comp</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">assets</span>
            <span class="k">return</span> <span class="n">error_assets</span>

        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s2">&quot;get_setting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_setting</span>
        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s2">&quot;search_assets_global&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_finder</span><span class="o">.</span><span class="n">search_assets</span>
        <span class="n">env</span><span class="o">.</span><span class="n">globals</span><span class="p">[</span><span class="s2">&quot;search_error_assets_global&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_error_assets_global</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_asset_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new file name inside the asset build directory with the same filename as the input file,</span>
<span class="sd">        except its file stem is suffixed with a unique uuid4 hash (first 8 chars).</span>

<span class="sd">        E.g. `foo/bar/iris_scatter_plot.html` --&gt; `&lt;asset-build-dir&gt;/&lt;component_name&gt;/iris_scatter_plot_ab8b4081.html`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="n">component_name</span> <span class="ow">or</span> <span class="n">context_stack</span><span class="o">.</span><span class="n">get_parent_context</span><span class="p">(</span><span class="s2">&quot;generate_assets&quot;</span><span class="p">)[</span><span class="s2">&quot;asset&quot;</span><span class="p">][</span><span class="s2">&quot;component_name&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="s2">&quot;unknown_component&quot;</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">asset_build_dir</span> <span class="o">/</span> <span class="n">component</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_build_dir</span> <span class="o">/</span> <span class="n">component</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}{</span><span class="n">file</span><span class="o">.</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span></div>



<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Component</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">validator</span><span class="o">=</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">attr</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">matches_re</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\w+&quot;</span><span class="p">)))</span>
    <span class="n">templates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">deep_iterable</span><span class="p">(</span>
            <span class="n">member_validator</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">iterable_validator</span><span class="o">=</span><span class="n">attrs</span><span class="o">.</span><span class="n">validators</span><span class="o">.</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">list</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">render_context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">resources</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">resources</span><span class="p">:</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">])</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">reserved_key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;component_name&quot;</span><span class="p">,</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">reserved_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_context</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reserved_key</span><span class="si">!r}</span><span class="s2"> is a reserved context key!&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">render_context</span><span class="p">,</span> <span class="n">component_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">resources</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dictconfig</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">omegaconf</span><span class="o">.</span><span class="n">DictConfig</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Component</span><span class="p">(</span><span class="o">**</span><span class="n">omegaconf</span><span class="o">.</span><span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_container</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">resolve</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>  <span class="c1"># type: ignore[arg-type]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .
      <span class="lastupdated">Last updated on Sep 30, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>